{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "sound-preparation",
   "metadata": {},
   "source": [
    "## Week 3 SQL Case Study \n",
    "#### Introduction"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "verified-element",
   "metadata": {},
   "source": [
    "Given the simplified table schemas provided below, write executable SQL queries to answer\n",
    "each question:\n",
    "1. List the top 20 cities by percentage share of total bookings between 2017-01-01 and\n",
    "2017-08-30 (be sure to include each cityâ€™s share in your output)\n",
    "2. For each of these top 20 cities, list their respective percentages of bookings that were\n",
    "canceled between 2017-01-01 and 2017-08-30\n",
    "3. For each week between 2017-01-01 and 2017-08-30, list the percentage breakdown of\n",
    "bookings made by repeat customers vs. first-time customers w/ promotion vs. first-time\n",
    "customers w/o promotion"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "correct-picture",
   "metadata": {},
   "source": [
    "Note : each reservation originates from a search request, and may be joined on\n",
    "reservation.search_request_id = search_request.id"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 58,
   "id": "buried-liabilities",
   "metadata": {},
   "outputs": [],
   "source": [
    "from faker import Faker \n",
    "import pandas as pd\n",
    "import numpy as np\n",
    "from datetime import timedelta\n",
    "fake = Faker()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "activated-interface",
   "metadata": {},
   "source": [
    "Creating the first **reservation** table with columns: *id, search_request_id, date_created, date_cancelled, user_id*"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 126,
   "id": "listed-nudist",
   "metadata": {},
   "outputs": [],
   "source": [
    "ids = np.random.randint(0,1000,500)\n",
    "search_request_id = np.random.randint(0,1000,500)\n",
    "userids = np.random.randint(0,1000,500)\n",
    "fakedates = []\n",
    "for _ in range(500):\n",
    "    fakedates.append(fake.date_between(start_date='-7y', end_date='today'))\n",
    "cancelleddates = fakedates[:300]\n",
    "for _ in range(200):\n",
    "    cancelleddates.append(np.nan)\n",
    "reservation = pd.DataFrame({'id' : ids, \n",
    "                          'search_request_id' : np.random.randint(0,1000,500),\n",
    "                          'date_created' : fakedates,\n",
    "                          'date_cancelled' : cancelleddates,\n",
    "                          'user_id' : userids\n",
    "                         })"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "finnish-offer",
   "metadata": {},
   "source": [
    "Creating the first **search_request** table with columns: *id, date_created, city_id, promotion_id, rooms, check_in, check_out*\n",
    "    "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 127,
   "id": "northern-spanish",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>id</th>\n",
       "      <th>date_created</th>\n",
       "      <th>city_id</th>\n",
       "      <th>promotion_id</th>\n",
       "      <th>rooms</th>\n",
       "      <th>check_in</th>\n",
       "      <th>check_out</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>318</td>\n",
       "      <td>2019-02-20</td>\n",
       "      <td>96</td>\n",
       "      <td>3.0</td>\n",
       "      <td>1</td>\n",
       "      <td>2019-02-28</td>\n",
       "      <td>2019-03-11</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>264</td>\n",
       "      <td>2019-09-28</td>\n",
       "      <td>93</td>\n",
       "      <td>6.0</td>\n",
       "      <td>4</td>\n",
       "      <td>2019-09-29</td>\n",
       "      <td>2019-10-20</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>470</td>\n",
       "      <td>2016-09-22</td>\n",
       "      <td>16</td>\n",
       "      <td>7.0</td>\n",
       "      <td>3</td>\n",
       "      <td>2016-09-24</td>\n",
       "      <td>2016-10-06</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>591</td>\n",
       "      <td>2018-10-24</td>\n",
       "      <td>11</td>\n",
       "      <td>0.0</td>\n",
       "      <td>3</td>\n",
       "      <td>2018-10-31</td>\n",
       "      <td>2018-11-06</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>51</td>\n",
       "      <td>2017-01-22</td>\n",
       "      <td>70</td>\n",
       "      <td>9.0</td>\n",
       "      <td>1</td>\n",
       "      <td>2017-01-25</td>\n",
       "      <td>2017-02-06</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "    id date_created  city_id  promotion_id  rooms    check_in   check_out\n",
       "0  318   2019-02-20       96           3.0      1  2019-02-28  2019-03-11\n",
       "1  264   2019-09-28       93           6.0      4  2019-09-29  2019-10-20\n",
       "2  470   2016-09-22       16           7.0      3  2016-09-24  2016-10-06\n",
       "3  591   2018-10-24       11           0.0      3  2018-10-31  2018-11-06\n",
       "4   51   2017-01-22       70           9.0      1  2017-01-25  2017-02-06"
      ]
     },
     "execution_count": 127,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "date_created = []\n",
    "check_in = []\n",
    "check_out = []\n",
    "for _ in range(500):\n",
    "    time1 = fake.date_between('-7y','today')\n",
    "    check_in.append(time1)\n",
    "    time2 = time1 + timedelta(days = np.random.randint(1,31))\n",
    "    check_out.append(time2)\n",
    "    time3 = time1 + timedelta(days = -1 * np.random.randint(1,11))\n",
    "    date_created.append(time3)\n",
    "city_id = np.random.randint(0,100,500)\n",
    "promotion_id = np.random.randint(0,10,350)\n",
    "for _ in range(150):\n",
    "    promotion_id = np.append(promotion_id, np.nan)\n",
    "rooms = np.random.randint(1,5,500)\n",
    "    \n",
    "search_request = pd.DataFrame({'id' : search_request_id,\n",
    "                               'date_created' : date_created,\n",
    "                               'city_id' : city_id,\n",
    "                               'promotion_id' : promotion_id,\n",
    "                               'rooms' : rooms,\n",
    "                               'check_in' : check_in,\n",
    "                               'check_out' : check_out\n",
    "                               })\n",
    "search_request.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 132,
   "id": "corresponding-public",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>id_x</th>\n",
       "      <th>date_created_x</th>\n",
       "      <th>city_id</th>\n",
       "      <th>promotion_id</th>\n",
       "      <th>rooms</th>\n",
       "      <th>check_in</th>\n",
       "      <th>check_out</th>\n",
       "      <th>id_y</th>\n",
       "      <th>search_request_id</th>\n",
       "      <th>date_created_y</th>\n",
       "      <th>date_cancelled</th>\n",
       "      <th>user_id</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>264</td>\n",
       "      <td>2019-09-28</td>\n",
       "      <td>93</td>\n",
       "      <td>6.0</td>\n",
       "      <td>4</td>\n",
       "      <td>2019-09-29</td>\n",
       "      <td>2019-10-20</td>\n",
       "      <td>337</td>\n",
       "      <td>264</td>\n",
       "      <td>2015-11-12</td>\n",
       "      <td>2015-11-12</td>\n",
       "      <td>909</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>264</td>\n",
       "      <td>2021-01-24</td>\n",
       "      <td>5</td>\n",
       "      <td>3.0</td>\n",
       "      <td>3</td>\n",
       "      <td>2021-01-28</td>\n",
       "      <td>2021-02-12</td>\n",
       "      <td>337</td>\n",
       "      <td>264</td>\n",
       "      <td>2015-11-12</td>\n",
       "      <td>2015-11-12</td>\n",
       "      <td>909</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>470</td>\n",
       "      <td>2016-09-22</td>\n",
       "      <td>16</td>\n",
       "      <td>7.0</td>\n",
       "      <td>3</td>\n",
       "      <td>2016-09-24</td>\n",
       "      <td>2016-10-06</td>\n",
       "      <td>599</td>\n",
       "      <td>470</td>\n",
       "      <td>2020-12-17</td>\n",
       "      <td>2020-12-17</td>\n",
       "      <td>38</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>470</td>\n",
       "      <td>2016-09-22</td>\n",
       "      <td>16</td>\n",
       "      <td>7.0</td>\n",
       "      <td>3</td>\n",
       "      <td>2016-09-24</td>\n",
       "      <td>2016-10-06</td>\n",
       "      <td>822</td>\n",
       "      <td>470</td>\n",
       "      <td>2016-06-04</td>\n",
       "      <td>NaN</td>\n",
       "      <td>475</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>470</td>\n",
       "      <td>2019-03-07</td>\n",
       "      <td>0</td>\n",
       "      <td>2.0</td>\n",
       "      <td>3</td>\n",
       "      <td>2019-03-08</td>\n",
       "      <td>2019-04-05</td>\n",
       "      <td>599</td>\n",
       "      <td>470</td>\n",
       "      <td>2020-12-17</td>\n",
       "      <td>2020-12-17</td>\n",
       "      <td>38</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>246</th>\n",
       "      <td>756</td>\n",
       "      <td>2016-03-05</td>\n",
       "      <td>88</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2</td>\n",
       "      <td>2016-03-10</td>\n",
       "      <td>2016-04-08</td>\n",
       "      <td>298</td>\n",
       "      <td>756</td>\n",
       "      <td>2016-06-18</td>\n",
       "      <td>2016-06-18</td>\n",
       "      <td>115</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>247</th>\n",
       "      <td>242</td>\n",
       "      <td>2018-02-05</td>\n",
       "      <td>59</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>2018-02-06</td>\n",
       "      <td>2018-02-21</td>\n",
       "      <td>484</td>\n",
       "      <td>242</td>\n",
       "      <td>2018-08-25</td>\n",
       "      <td>NaN</td>\n",
       "      <td>393</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>248</th>\n",
       "      <td>124</td>\n",
       "      <td>2018-11-08</td>\n",
       "      <td>62</td>\n",
       "      <td>NaN</td>\n",
       "      <td>3</td>\n",
       "      <td>2018-11-17</td>\n",
       "      <td>2018-12-06</td>\n",
       "      <td>417</td>\n",
       "      <td>124</td>\n",
       "      <td>2016-12-30</td>\n",
       "      <td>2016-12-30</td>\n",
       "      <td>964</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>249</th>\n",
       "      <td>338</td>\n",
       "      <td>2015-12-02</td>\n",
       "      <td>71</td>\n",
       "      <td>NaN</td>\n",
       "      <td>4</td>\n",
       "      <td>2015-12-05</td>\n",
       "      <td>2015-12-13</td>\n",
       "      <td>529</td>\n",
       "      <td>338</td>\n",
       "      <td>2016-05-11</td>\n",
       "      <td>2016-05-11</td>\n",
       "      <td>48</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>250</th>\n",
       "      <td>654</td>\n",
       "      <td>2015-06-29</td>\n",
       "      <td>97</td>\n",
       "      <td>NaN</td>\n",
       "      <td>4</td>\n",
       "      <td>2015-07-02</td>\n",
       "      <td>2015-07-20</td>\n",
       "      <td>629</td>\n",
       "      <td>654</td>\n",
       "      <td>2019-04-03</td>\n",
       "      <td>2019-04-03</td>\n",
       "      <td>714</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>251 rows Ã— 12 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "     id_x date_created_x  city_id  promotion_id  rooms    check_in  \\\n",
       "0     264     2019-09-28       93           6.0      4  2019-09-29   \n",
       "1     264     2021-01-24        5           3.0      3  2021-01-28   \n",
       "2     470     2016-09-22       16           7.0      3  2016-09-24   \n",
       "3     470     2016-09-22       16           7.0      3  2016-09-24   \n",
       "4     470     2019-03-07        0           2.0      3  2019-03-08   \n",
       "..    ...            ...      ...           ...    ...         ...   \n",
       "246   756     2016-03-05       88           NaN      2  2016-03-10   \n",
       "247   242     2018-02-05       59           NaN      1  2018-02-06   \n",
       "248   124     2018-11-08       62           NaN      3  2018-11-17   \n",
       "249   338     2015-12-02       71           NaN      4  2015-12-05   \n",
       "250   654     2015-06-29       97           NaN      4  2015-07-02   \n",
       "\n",
       "      check_out  id_y  search_request_id date_created_y date_cancelled  \\\n",
       "0    2019-10-20   337                264     2015-11-12     2015-11-12   \n",
       "1    2021-02-12   337                264     2015-11-12     2015-11-12   \n",
       "2    2016-10-06   599                470     2020-12-17     2020-12-17   \n",
       "3    2016-10-06   822                470     2016-06-04            NaN   \n",
       "4    2019-04-05   599                470     2020-12-17     2020-12-17   \n",
       "..          ...   ...                ...            ...            ...   \n",
       "246  2016-04-08   298                756     2016-06-18     2016-06-18   \n",
       "247  2018-02-21   484                242     2018-08-25            NaN   \n",
       "248  2018-12-06   417                124     2016-12-30     2016-12-30   \n",
       "249  2015-12-13   529                338     2016-05-11     2016-05-11   \n",
       "250  2015-07-20   629                654     2019-04-03     2019-04-03   \n",
       "\n",
       "     user_id  \n",
       "0        909  \n",
       "1        909  \n",
       "2         38  \n",
       "3        475  \n",
       "4         38  \n",
       "..       ...  \n",
       "246      115  \n",
       "247      393  \n",
       "248      964  \n",
       "249       48  \n",
       "250      714  \n",
       "\n",
       "[251 rows x 12 columns]"
      ]
     },
     "execution_count": 132,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "concatdf = pd.merge(left = search_request, right = reservation, left_on = 'id', right_on = 'search_request_id')\n",
    "concatdf"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 159,
   "id": "removed-commercial",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>id_x</th>\n",
       "      <th>search_request_id</th>\n",
       "      <th>date_created_x</th>\n",
       "      <th>date_cancelled</th>\n",
       "      <th>user_id</th>\n",
       "      <th>id_y</th>\n",
       "      <th>date_created_y</th>\n",
       "      <th>city_id</th>\n",
       "      <th>promotion_id</th>\n",
       "      <th>rooms</th>\n",
       "      <th>check_in</th>\n",
       "      <th>check_out</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>504</td>\n",
       "      <td>327</td>\n",
       "      <td>2017-05-20</td>\n",
       "      <td>2017-05-20</td>\n",
       "      <td>619</td>\n",
       "      <td>327</td>\n",
       "      <td>2020-11-10</td>\n",
       "      <td>99</td>\n",
       "      <td>5.0</td>\n",
       "      <td>4</td>\n",
       "      <td>2020-11-15</td>\n",
       "      <td>2020-12-09</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>615</td>\n",
       "      <td>327</td>\n",
       "      <td>2018-09-15</td>\n",
       "      <td>2018-09-15</td>\n",
       "      <td>992</td>\n",
       "      <td>327</td>\n",
       "      <td>2020-11-10</td>\n",
       "      <td>99</td>\n",
       "      <td>5.0</td>\n",
       "      <td>4</td>\n",
       "      <td>2020-11-15</td>\n",
       "      <td>2020-12-09</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>292</td>\n",
       "      <td>810</td>\n",
       "      <td>2018-01-21</td>\n",
       "      <td>2018-01-21</td>\n",
       "      <td>699</td>\n",
       "      <td>810</td>\n",
       "      <td>2020-01-23</td>\n",
       "      <td>11</td>\n",
       "      <td>7.0</td>\n",
       "      <td>3</td>\n",
       "      <td>2020-02-02</td>\n",
       "      <td>2020-02-08</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>612</td>\n",
       "      <td>810</td>\n",
       "      <td>2017-08-03</td>\n",
       "      <td>2017-08-03</td>\n",
       "      <td>995</td>\n",
       "      <td>810</td>\n",
       "      <td>2020-01-23</td>\n",
       "      <td>11</td>\n",
       "      <td>7.0</td>\n",
       "      <td>3</td>\n",
       "      <td>2020-02-02</td>\n",
       "      <td>2020-02-08</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>295</td>\n",
       "      <td>569</td>\n",
       "      <td>2014-05-20</td>\n",
       "      <td>2014-05-20</td>\n",
       "      <td>943</td>\n",
       "      <td>569</td>\n",
       "      <td>2015-06-22</td>\n",
       "      <td>78</td>\n",
       "      <td>6.0</td>\n",
       "      <td>4</td>\n",
       "      <td>2015-06-28</td>\n",
       "      <td>2015-07-16</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   id_x  search_request_id date_created_x date_cancelled  user_id  id_y  \\\n",
       "0   504                327     2017-05-20     2017-05-20      619   327   \n",
       "1   615                327     2018-09-15     2018-09-15      992   327   \n",
       "2   292                810     2018-01-21     2018-01-21      699   810   \n",
       "3   612                810     2017-08-03     2017-08-03      995   810   \n",
       "4   295                569     2014-05-20     2014-05-20      943   569   \n",
       "\n",
       "  date_created_y  city_id  promotion_id  rooms    check_in   check_out  \n",
       "0     2020-11-10       99           5.0      4  2020-11-15  2020-12-09  \n",
       "1     2020-11-10       99           5.0      4  2020-11-15  2020-12-09  \n",
       "2     2020-01-23       11           7.0      3  2020-02-02  2020-02-08  \n",
       "3     2020-01-23       11           7.0      3  2020-02-02  2020-02-08  \n",
       "4     2015-06-22       78           6.0      4  2015-06-28  2015-07-16  "
      ]
     },
     "execution_count": 159,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "concatdf = pd.merge(left = reservation, right = search_request, left_on = 'search_request_id', right_on = 'id')\n",
    "concatdf.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 194,
   "id": "metric-moderator",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>city_id</th>\n",
       "      <th>id_x</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>21</th>\n",
       "      <td>22</td>\n",
       "      <td>9</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>33</th>\n",
       "      <td>36</td>\n",
       "      <td>8</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>68</th>\n",
       "      <td>76</td>\n",
       "      <td>7</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>62</th>\n",
       "      <td>70</td>\n",
       "      <td>7</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>11</td>\n",
       "      <td>7</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>73</th>\n",
       "      <td>81</td>\n",
       "      <td>6</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>56</th>\n",
       "      <td>63</td>\n",
       "      <td>6</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>16</td>\n",
       "      <td>6</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>35</th>\n",
       "      <td>38</td>\n",
       "      <td>5</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>34</th>\n",
       "      <td>37</td>\n",
       "      <td>5</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>46</th>\n",
       "      <td>49</td>\n",
       "      <td>5</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>54</th>\n",
       "      <td>61</td>\n",
       "      <td>5</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>58</th>\n",
       "      <td>66</td>\n",
       "      <td>5</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>89</th>\n",
       "      <td>99</td>\n",
       "      <td>5</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>86</th>\n",
       "      <td>95</td>\n",
       "      <td>5</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>72</th>\n",
       "      <td>80</td>\n",
       "      <td>4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>81</th>\n",
       "      <td>90</td>\n",
       "      <td>4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2</td>\n",
       "      <td>4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>87</th>\n",
       "      <td>96</td>\n",
       "      <td>4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>44</th>\n",
       "      <td>47</td>\n",
       "      <td>4</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "    city_id  id_x\n",
       "21       22     9\n",
       "33       36     8\n",
       "68       76     7\n",
       "62       70     7\n",
       "10       11     7\n",
       "73       81     6\n",
       "56       63     6\n",
       "15       16     6\n",
       "35       38     5\n",
       "34       37     5\n",
       "46       49     5\n",
       "54       61     5\n",
       "58       66     5\n",
       "89       99     5\n",
       "86       95     5\n",
       "72       80     4\n",
       "81       90     4\n",
       "2         2     4\n",
       "87       96     4\n",
       "44       47     4"
      ]
     },
     "execution_count": 194,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#20 cities accounting for highest number of reservations\n",
    "concatdf.groupby('city_id')['id_x'].count().reset_index().sort_values(by = 'id_x', ascending = False).head(20)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "precise-alaska",
   "metadata": {},
   "source": [
    "### Question 2"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 197,
   "id": "twelve-title",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/Users/philippeheitzmann/opt/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:1: FutureWarning: Indexing with multiple keys (implicitly converted to a tuple of keys) will be deprecated, use a list instead.\n",
      "  \"\"\"Entry point for launching an IPython kernel.\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>city_id</th>\n",
       "      <th>id_x</th>\n",
       "      <th>date_created_x</th>\n",
       "      <th>date_cancelled</th>\n",
       "      <th>cancelled_perc</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>21</th>\n",
       "      <td>99</td>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "      <td>1.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18</th>\n",
       "      <td>92</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>22</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>33</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>47</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>21</td>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "      <td>1.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>88</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>76</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19</th>\n",
       "      <td>93</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>11</td>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "      <td>1.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>87</td>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "      <td>1</td>\n",
       "      <td>0.5</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>82</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>79</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>20</th>\n",
       "      <td>94</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>2</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>54</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>70</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>40</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>36</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>32</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "    city_id  id_x  date_created_x  date_cancelled  cancelled_perc\n",
       "21       99     2               2               2             1.0\n",
       "18       92     1               1               1             1.0\n",
       "4        22     1               1               1             1.0\n",
       "6        33     1               1               1             1.0\n",
       "9        47     1               1               1             1.0\n",
       "3        21     2               2               2             1.0\n",
       "17       88     1               1               1             1.0\n",
       "13       76     1               1               1             1.0\n",
       "19       93     1               1               1             1.0\n",
       "1        11     2               2               2             1.0\n",
       "16       87     2               2               1             0.5\n",
       "15       82     1               1               0             0.0\n",
       "14       79     1               1               0             0.0\n",
       "20       94     1               1               0             0.0\n",
       "0         2     1               1               0             0.0\n",
       "10       54     1               1               0             0.0\n",
       "12       70     1               1               0             0.0\n",
       "8        40     1               1               0             0.0\n",
       "7        36     1               1               0             0.0\n",
       "5        32     1               1               0             0.0"
      ]
     },
     "execution_count": 197,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "q2df = concatdf[(concatdf.date_created_x > datetime.date(2017,1,1)) & (concatdf.date_created_x < datetime.date(2017,8,30))].groupby('city_id')['id_x','date_created_x','date_cancelled'].agg({'id_x':'count','date_created_x':'count','date_cancelled':'count'}).reset_index().sort_values(by = 'id_x', ascending = False)\n",
    "q2df['cancelled_perc'] = q2df['date_cancelled'] / q2df['date_created_x']\n",
    "q2df.sort_values(by = 'cancelled_perc', ascending = False).head(20)\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "bronze-judges",
   "metadata": {},
   "source": [
    "### Question 3"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 252,
   "id": "appointed-baker",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "4965"
      ]
     },
     "execution_count": 252,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "sum(np.random.binomial(10,0.5,1000))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 260,
   "id": "ignored-engineering",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0.099"
      ]
     },
     "execution_count": 260,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "sum(np.random.binomial(10,0.5,1000) == 3)/1000"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 168,
   "id": "missing-treasurer",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[datetime.date(2017, 1, 1), datetime.date(2017, 1, 8), datetime.date(2017, 1, 15), datetime.date(2017, 1, 22), datetime.date(2017, 1, 29), datetime.date(2017, 2, 5), datetime.date(2017, 2, 12), datetime.date(2017, 2, 19), datetime.date(2017, 2, 26), datetime.date(2017, 3, 5), datetime.date(2017, 3, 12), datetime.date(2017, 3, 19), datetime.date(2017, 3, 26), datetime.date(2017, 4, 2), datetime.date(2017, 4, 9), datetime.date(2017, 4, 16), datetime.date(2017, 4, 23), datetime.date(2017, 4, 30), datetime.date(2017, 5, 7), datetime.date(2017, 5, 14), datetime.date(2017, 5, 21), datetime.date(2017, 5, 28), datetime.date(2017, 6, 4), datetime.date(2017, 6, 11), datetime.date(2017, 6, 18), datetime.date(2017, 6, 25), datetime.date(2017, 7, 2), datetime.date(2017, 7, 9), datetime.date(2017, 7, 16), datetime.date(2017, 7, 23), datetime.date(2017, 7, 30), datetime.date(2017, 8, 6), datetime.date(2017, 8, 13), datetime.date(2017, 8, 20), datetime.date(2017, 8, 27), datetime.date(2017, 9, 3), datetime.date(2017, 9, 10), datetime.date(2017, 9, 17), datetime.date(2017, 9, 24), datetime.date(2017, 10, 1), datetime.date(2017, 10, 8), datetime.date(2017, 10, 15), datetime.date(2017, 10, 22), datetime.date(2017, 10, 29), datetime.date(2017, 11, 5), datetime.date(2017, 11, 12), datetime.date(2017, 11, 19), datetime.date(2017, 11, 26), datetime.date(2017, 12, 3), datetime.date(2017, 12, 10), datetime.date(2017, 12, 17), datetime.date(2017, 12, 24), datetime.date(2017, 12, 31)]\n"
     ]
    }
   ],
   "source": [
    "binsweeks = []\n",
    "for x in range(53):\n",
    "    binsweeks.append(datetime.date(2017,1,1) + timedelta(days = 7) * x)\n",
    "print(binsweeks)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 183,
   "id": "charming-screw",
   "metadata": {},
   "outputs": [],
   "source": [
    "q3df = concatdf[(concatdf.date_created_x > datetime.date(2017,1,1)) & \n",
    "                       (concatdf.date_created_x < datetime.date(2017,12,31))][['date_created_x','id_x','promotion_id']]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 184,
   "id": "comfortable-front",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>date_created_x</th>\n",
       "      <th>id_x</th>\n",
       "      <th>promotion_id</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>2017-05-20</td>\n",
       "      <td>504</td>\n",
       "      <td>5.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>2017-08-03</td>\n",
       "      <td>612</td>\n",
       "      <td>7.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>2017-12-28</td>\n",
       "      <td>688</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>31</th>\n",
       "      <td>2017-05-05</td>\n",
       "      <td>656</td>\n",
       "      <td>4.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>36</th>\n",
       "      <td>2017-11-15</td>\n",
       "      <td>79</td>\n",
       "      <td>4.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   date_created_x  id_x  promotion_id\n",
       "0      2017-05-20   504           5.0\n",
       "3      2017-08-03   612           7.0\n",
       "9      2017-12-28   688           0.0\n",
       "31     2017-05-05   656           4.0\n",
       "36     2017-11-15    79           4.0"
      ]
     },
     "execution_count": 184,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "q3df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 187,
   "id": "dense-rabbit",
   "metadata": {},
   "outputs": [],
   "source": [
    "q3df['date_created_x'] = pd.to_datetime(q3df['date_created_x'])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 189,
   "id": "phantom-message",
   "metadata": {},
   "outputs": [],
   "source": [
    "q3ans = q3df.groupby(pd.Grouper(key=\"date_created_x\", freq=\"1W\")).count().reset_index()\n",
    "q3ans['promo_perc'] = q3ans['promotion_id'] / q3ans['id_x']"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 190,
   "id": "orange-ballet",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>date_created_x</th>\n",
       "      <th>id_x</th>\n",
       "      <th>promotion_id</th>\n",
       "      <th>promo_perc</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>2017-01-08</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2017-01-15</td>\n",
       "      <td>4</td>\n",
       "      <td>3</td>\n",
       "      <td>0.750000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2017-01-22</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>2017-01-29</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2017-02-05</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>2017-02-12</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>2017-02-19</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>2017-02-26</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>2017-03-05</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>2017-03-12</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>2017-03-19</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>2017-03-26</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>2017-04-02</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>2017-04-09</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>2017-04-16</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>2017-04-23</td>\n",
       "      <td>2</td>\n",
       "      <td>1</td>\n",
       "      <td>0.500000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>2017-04-30</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>2017-05-07</td>\n",
       "      <td>2</td>\n",
       "      <td>1</td>\n",
       "      <td>0.500000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18</th>\n",
       "      <td>2017-05-14</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19</th>\n",
       "      <td>2017-05-21</td>\n",
       "      <td>3</td>\n",
       "      <td>3</td>\n",
       "      <td>1.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>20</th>\n",
       "      <td>2017-05-28</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>21</th>\n",
       "      <td>2017-06-04</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>22</th>\n",
       "      <td>2017-06-11</td>\n",
       "      <td>3</td>\n",
       "      <td>3</td>\n",
       "      <td>1.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>23</th>\n",
       "      <td>2017-06-18</td>\n",
       "      <td>2</td>\n",
       "      <td>0</td>\n",
       "      <td>0.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>24</th>\n",
       "      <td>2017-06-25</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>25</th>\n",
       "      <td>2017-07-02</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>26</th>\n",
       "      <td>2017-07-09</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>27</th>\n",
       "      <td>2017-07-16</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>28</th>\n",
       "      <td>2017-07-23</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>29</th>\n",
       "      <td>2017-07-30</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>30</th>\n",
       "      <td>2017-08-06</td>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "      <td>1.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>31</th>\n",
       "      <td>2017-08-13</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>32</th>\n",
       "      <td>2017-08-20</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>33</th>\n",
       "      <td>2017-08-27</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>34</th>\n",
       "      <td>2017-09-03</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>35</th>\n",
       "      <td>2017-09-10</td>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "      <td>1.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>36</th>\n",
       "      <td>2017-09-17</td>\n",
       "      <td>3</td>\n",
       "      <td>2</td>\n",
       "      <td>0.666667</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>37</th>\n",
       "      <td>2017-09-24</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>38</th>\n",
       "      <td>2017-10-01</td>\n",
       "      <td>2</td>\n",
       "      <td>1</td>\n",
       "      <td>0.500000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>39</th>\n",
       "      <td>2017-10-08</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>40</th>\n",
       "      <td>2017-10-15</td>\n",
       "      <td>2</td>\n",
       "      <td>1</td>\n",
       "      <td>0.500000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>41</th>\n",
       "      <td>2017-10-22</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>42</th>\n",
       "      <td>2017-10-29</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>43</th>\n",
       "      <td>2017-11-05</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>44</th>\n",
       "      <td>2017-11-12</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>45</th>\n",
       "      <td>2017-11-19</td>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "      <td>1.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>46</th>\n",
       "      <td>2017-11-26</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>47</th>\n",
       "      <td>2017-12-03</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>48</th>\n",
       "      <td>2017-12-10</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>49</th>\n",
       "      <td>2017-12-17</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>50</th>\n",
       "      <td>2017-12-24</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>51</th>\n",
       "      <td>2017-12-31</td>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "      <td>1.000000</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   date_created_x  id_x  promotion_id  promo_perc\n",
       "0      2017-01-08     1             1    1.000000\n",
       "1      2017-01-15     4             3    0.750000\n",
       "2      2017-01-22     0             0         NaN\n",
       "3      2017-01-29     0             0         NaN\n",
       "4      2017-02-05     1             1    1.000000\n",
       "5      2017-02-12     0             0         NaN\n",
       "6      2017-02-19     0             0         NaN\n",
       "7      2017-02-26     0             0         NaN\n",
       "8      2017-03-05     1             1    1.000000\n",
       "9      2017-03-12     1             1    1.000000\n",
       "10     2017-03-19     0             0         NaN\n",
       "11     2017-03-26     0             0         NaN\n",
       "12     2017-04-02     0             0         NaN\n",
       "13     2017-04-09     1             1    1.000000\n",
       "14     2017-04-16     0             0         NaN\n",
       "15     2017-04-23     2             1    0.500000\n",
       "16     2017-04-30     1             1    1.000000\n",
       "17     2017-05-07     2             1    0.500000\n",
       "18     2017-05-14     0             0         NaN\n",
       "19     2017-05-21     3             3    1.000000\n",
       "20     2017-05-28     0             0         NaN\n",
       "21     2017-06-04     0             0         NaN\n",
       "22     2017-06-11     3             3    1.000000\n",
       "23     2017-06-18     2             0    0.000000\n",
       "24     2017-06-25     1             1    1.000000\n",
       "25     2017-07-02     0             0         NaN\n",
       "26     2017-07-09     0             0         NaN\n",
       "27     2017-07-16     0             0         NaN\n",
       "28     2017-07-23     0             0         NaN\n",
       "29     2017-07-30     0             0         NaN\n",
       "30     2017-08-06     2             2    1.000000\n",
       "31     2017-08-13     1             0    0.000000\n",
       "32     2017-08-20     0             0         NaN\n",
       "33     2017-08-27     0             0         NaN\n",
       "34     2017-09-03     0             0         NaN\n",
       "35     2017-09-10     2             2    1.000000\n",
       "36     2017-09-17     3             2    0.666667\n",
       "37     2017-09-24     0             0         NaN\n",
       "38     2017-10-01     2             1    0.500000\n",
       "39     2017-10-08     0             0         NaN\n",
       "40     2017-10-15     2             1    0.500000\n",
       "41     2017-10-22     0             0         NaN\n",
       "42     2017-10-29     0             0         NaN\n",
       "43     2017-11-05     0             0         NaN\n",
       "44     2017-11-12     0             0         NaN\n",
       "45     2017-11-19     2             2    1.000000\n",
       "46     2017-11-26     1             0    0.000000\n",
       "47     2017-12-03     1             1    1.000000\n",
       "48     2017-12-10     0             0         NaN\n",
       "49     2017-12-17     1             1    1.000000\n",
       "50     2017-12-24     0             0         NaN\n",
       "51     2017-12-31     2             2    1.000000"
      ]
     },
     "execution_count": 190,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "q3ans"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "thrown-spouse",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.7"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
